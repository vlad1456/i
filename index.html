<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="description" content="Vlad Slyusar's Digital Resume + 3D City Demo">
  <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, target-densitydpi=device-dpi">
  <title>Vlad Slyusar | Digital Resume 3D</title>
  
  <!-- THREE.JS -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.152.0/build/three.min.js"></script>
  <!-- Globe.GL (for the interactive globe) -->
  <script src="//unpkg.com/globe.gl"></script>
  
  <style>
    /* Basic global styles */
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: sans-serif;
      overflow: hidden; /* Prevent window scrolling directly */
      text-align: center;
    }
    
    /* Full viewport container for the globe */
    #globeViz {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: 997; /* Behind the header and scroll-fade overlay */
      pointer-events: none;
      /* Initial opacity set to 1 (fully visible) */
      opacity: 1;
      transition: opacity 0.5s ease-out;
    }
    
    /* Fade overlay for scrolling intro effect */
    #scroll-fade {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      pointer-events: none;
      z-index: 998;
      opacity: 1;
      transition: opacity 1s ease-out;
    }
    
    /* Create a scrollable container for all page content */
    .scrollable-content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      scroll-behavior: smooth;
      z-index: 999; /* Content sits above the globe background */
    }
    
    canvas {
      display: block;
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      z-index: -1;
    }
    
    /* Container to help center and manage max width for content */
    .container {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      box-sizing: border-box;
      padding: 1rem;
    }
    
    .pdf-container {
      width: calc(100% - 2rem);
      margin: 1rem;
      display: block;
      overflow: hidden;
      position: relative;
      padding-top: 110%;
    }
    
    object {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
    
    /* Header */
    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
      padding: 1rem;
      background: rgba(0,0,0,0.9);
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    header h1 {
      position: absolute;
      left: 1rem;
      margin: 0;
      font-size: 1.4rem;
      font-weight: 600;
    }
    
    /* New narrow view buttons */
    .narrow-btn {
      display: none;
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
      text-decoration: none;
      margin-left: 1rem;
      background: rgba(0, 0, 0, 0.7);
      padding: 0.5rem 1rem;
      border-radius: 5px;
    }
    
    .narrow-btn:hover {
      color: hotpink;
    }
    
    .hamburger {
      position: absolute;
      right: 1rem;
      font-size: 1.5rem;
      cursor: pointer;
      color: #fff;
      display: none;
    }
    
    nav {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    nav a {
      margin: 0 1rem;
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
      text-decoration: none;
    }
    
    nav a:hover {
      color: hotpink;
    }
    
    /* Uniform spacing for main sections */
    section {
      padding: 6rem 2rem 2rem 2rem;
      margin-bottom: 20rem;
      box-sizing: border-box;
    }
    h2 {
      margin-top: 0;
      letter-spacing: 1px;
    }
    
    /* Reusable background block */
    .block-bg {
      background: rgba(0,0,0,0.5);
      padding: 1rem 2rem;
      border-radius: 10px;
      margin: 1rem auto;
      max-width: 800px;
    }
    
    /* Two-column section layout */
    .columns {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      justify-content: center;
      gap: 2rem;
      margin-top: 1rem;
    }
    .column {
      flex: 1 1 300px;
      max-width: 600px;
      box-sizing: border-box;
    }
    
    /* Image placeholders with rounded corners */
    .rounded-image {
      width: 100%;
      max-width: 500px;
      height: auto;
      border-radius: 10px;
      display: block;
      margin: 0 auto 1rem auto;
    }
    
    /* Lists and typography */
    ul {
      text-align: left;
      margin: 0 auto 1rem auto;
      padding-left: 1.2rem;
    }
    p {
      margin: 0 auto 1rem auto;
      line-height: 1.5;
      color: rgba(255,255,255,0.85);
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 2rem 1rem;
      background: rgba(0,0,0,0.3);
    }
    
    /* Responsive navigation */
    @media (max-width:768px) {
      nav {
        display: none;
        flex-direction: column;
        background: rgba(0,0,0,0.9);
        position: absolute;
        top: 60px;
        right: 1rem;
        border-radius: 5px;
        padding: 1rem;
      }
      nav a {
        margin: 0.5rem 0;
      }
      .hamburger {
        display: block;
      }
      .narrow-btn {
        display: inline-block;
      }
    }
    
    nav.active {
      display: flex;
    }
    
    /* Contact Form */
    #contact-form {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    #contact-form input[type="email"] {
      padding: 0.5rem;
      margin-bottom: 1rem;
      border: none;
      border-radius: 5px;
      width: 100%;
      max-width: 300px;
    }
    
    #contact-form button {
      padding: 0.5rem 1rem;
      border: none;
      border-radius: 5px;
      background: hotpink;
      color: #fff;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    
    #contact-form button:hover {
      background: #ff69b4;
    }
  </style>
</head>

<body>
  <!-- Globe container (full screen at the top) -->
  <div id="globeViz"></div>
  
  <!-- Scroll fade overlay -->
  <div id="scroll-fade"></div>
  
  <!-- THREE.js canvas (used later by the existing 3D city code) -->
  <canvas id="webgl-bg"></canvas>
  
  <!-- Header -->
  <header>
    <h1>Vlad Slyusar</h1>
    <a href="#resume3d" id="narrow-home" class="narrow-btn">Home</a>
    <a href="#contact" id="narrow-contact" class="narrow-btn">Contact</a>
    <div class="hamburger" id="hamburger" aria-label="Toggle navigation" aria-expanded="false">&#9776;</div>
    <nav id="nav-links">
      <a href="#resume3d">Home</a>
      <a href="#intro">Intro</a>
      <a href="#school">School</a>
      <a href="#work">Work</a>
      <a href="#projects">Projects</a>
      <a href="#publications">Patents</a>
      <a href="#leadership">Leadership</a>
      <a href="#contact">Contact</a>
    </nav>
  </header>
  
  <!-- Scrollable Content Wrapper -->
  <div class="scrollable-content" id="scrollable-content">
    <!-- 3D Resume (One column) -->
    <section id="resume3d">
      <div class="container">
        <h2>3D Resume</h2>
        <div hidden class="block-bg">
          <p>Welcome to my interactive 3D resume. Scroll down to explore more!</p>
        </div>
      </div>
    </section>
    <!-- (The rest of your sections, Intro, Skills, Education, Work, Projects, Publications, Leadership, Contact, etc.) -->
    <!-- ... (Keep your existing content unchanged) ... -->
    
    <!-- For brevity, the remainder of your HTML content remains as it was in your original code. -->
    <!-- Make sure all your sections and footer come within the #scrollable-content container -->
    
    <!-- Example: Intro Section -->
    <section id="intro">
      <div class="container">
        <h2>Introduction</h2>
        <div class="block-bg">
          <p>
            Highly accomplished Computer/Electrical Engineer with over 10 years experience...
          </p>
        </div>
        <br>
        <img src="i.jpg" alt="Vlad Slyusar" class="rounded-image">
        <br>
        <div class="block-bg">
          <p>
            Possesses in-depth expertise in 5G/mmWave, RTK/NRTK GNSS, MEC, Edge AI, SDR, and DevSecOps...
          </p>
        </div>
      </div>
    </section>
    
    <!-- ... (Your remaining sections: Technical Skills, Education, Work, Projects, Publications, Leadership, Contact, etc.) ... -->
  
    <footer>&copy; 2025 Vlad Slyusar â€” All rights reserved.</footer>
  </div>
  
  <!-- Module script to initialize the Globe and update its opacity on scroll -->
  <script type="module">
    import { csvParse } from 'https://esm.sh/d3-dsv';

    const globeElem = document.getElementById('globeViz');

    // Initialize the globe using Globe.GL
    const world = new Globe(globeElem)
      .globeImageUrl('//unpkg.com/three-globe/example/img/earth-night.jpg')
      .heatmapPointLat('lat')
      .heatmapPointLng('lng')
      .heatmapPointWeight('pop')
      .heatmapBandwidth(0.9)
      .heatmapColorSaturation(2.8)
      .enablePointerInteraction(false);

    // Load CSV data and set up heatmap
    fetch('https://raw.githubusercontent.com/down2chill/globe/refs/heads/main/world_population.csv')
      .then(res => res.text())
      .then(csv => csvParse(csv, ({ lat, lng, pop }) => ({ lat: +lat, lng: +lng, pop: +pop })))
      .then(data => world.heatmapsData([data]));

    // Update the globe's opacity based on scroll
    const scrollableContent = document.getElementById('scrollable-content');
    const fadeThreshold = 200; // adjust the scroll length for full fade-out as needed
    scrollableContent.addEventListener('scroll', () => {
      const sy = scrollableContent.scrollTop;
      const opacity = sy < fadeThreshold ? 1 - sy / fadeThreshold : 0;
      globeElem.style.opacity = opacity;
    });
  </script>
  
  <!-- Existing Three.js and page scripts -->
  <script>
    // Select the scrollable container
    const scrollableContent = document.getElementById('scrollable-content');

    // Setup renderer and replace canvas element
    const r = new THREE.WebGLRenderer({ antialias: true });
    const c = document.getElementById('webgl-bg');
    r.setSize(window.innerWidth, window.innerHeight);
    c.replaceWith(r.domElement);
    r.domElement.id = 'webgl-bg';
    
    if(window.innerWidth > 800){
      r.shadowMap.enabled = true;
      r.shadowMap.type = THREE.PCFSoftShadowMap;
      r.shadowMap.needsUpdate = true;
    }

    const s = new THREE.Scene();
    s.background = new THREE.Color(0x7B61FF);
    s.fog = new THREE.Fog(0x7B61FF, 10, 16);

    const fogOrig = { near: 10, far: 60 },
          fogRed = { near: 1000, far: 10000 },
          fogTgt = { near: 10, far: 16 };
    let disableFog = false;

    const cam = new THREE.PerspectiveCamera(30, window.innerWidth/window.innerHeight, 1, 500);
    cam.position.set(10,15,10);
    cam.lookAt(0,0,0);

    // Create City
    const city = new THREE.Object3D();
    s.add(city);
    const smoke = new THREE.Object3D();
    city.add(smoke);
    const town = new THREE.Object3D();
    city.add(town);
    const blds = [];
    function rand(num = 8) {
      return -Math.random() * num + Math.random() * num;
    }
    let tintFlag = true;
    function tint() { 
      tintFlag = !tintFlag; 
      return tintFlag ? 0x111111 : 0x333333;
    }
    function free(x, z, arr, md) {
      return !arr.some(p => (p.x - x) ** 2 + (p.z - z) ** 2 < md ** 2);
    }

    function initCity(){
      const cnt = 80,
            minD = 0.8,
            seg = 2;
      const placed = [];
      for(let i = 0; i < cnt; i++){
        const geom = new THREE.BoxGeometry(1, 1, 1, seg, seg, seg);
        const mat = new THREE.MeshStandardMaterial({color: tint(), side: THREE.DoubleSide});
        const wmat = new THREE.MeshLambertMaterial({
          color: 0xffffff,
          wireframe: true,
          transparent: true,
          opacity: 0.05,
          side: THREE.DoubleSide
        });
        const cube = new THREE.Mesh(geom, mat);
        const wire = new THREE.Mesh(geom, wmat);
        cube.add(wire);
        cube.castShadow = true;
        cube.receiveShadow = true;
        const h = (0.1 + Math.abs(rand(8))) / 2;
        cube.scale.y = h;
        cube.userData.h = h;
        blds.push(cube);
        cube.scale.x = cube.scale.z = 0.9 + rand(1 - 0.9);
        let placedFlag = false, a = 0;
        while(!placedFlag && a++ < 1000){
          const rx = Math.round(rand(15)),
                rz = Math.round(rand(15));
          if(free(rx, rz, placed, minD)){
            cube.position.set(rx, h / 2, rz);
            placed.push({x: rx, z: rz});
            placedFlag = true;
          }
        }
        town.add(cube);
      }

      // Smoke
      const gmat = new THREE.MeshToonMaterial({color: 0xffff00, side: THREE.DoubleSide});
      const ggeo = new THREE.CircleGeometry(0.01, 3);
      const apart = 5;
      for(let h = 1; h < 300; h++){
        const p = new THREE.Mesh(ggeo, gmat);
        p.position.set(rand(apart), Math.abs(rand(2)), rand(apart));
        smoke.add(p);
      }

      // Ground
      const pmat = new THREE.MeshPhongMaterial({
        color: 0x000000,
        side: THREE.DoubleSide,
        roughness: 10,
        metalness: 0.6,
        opacity: 0.9,
        transparent: true
      });
      const pgeo = new THREE.PlaneGeometry(60, 60);
      const pe = new THREE.Mesh(pgeo, pmat);
      pe.rotation.x = -Math.PI / 2;
      pe.position.y = -0.001;
      pe.receiveShadow = true;
      city.add(pe);
    }
    initCity();

    // Lights
    const aLight = new THREE.AmbientLight(0xffffff, 4);
    const lFront = new THREE.SpotLight(0xffffff, 20, 10);
    lFront.rotation.x = 45 * Math.PI / 180;
    lFront.rotation.z = -45 * Math.PI / 180;
    lFront.position.set(5, 5, 5);
    lFront.castShadow = true;
    lFront.shadow.mapSize.width = 6000;
    lFront.shadow.mapSize.height = 6000;
    lFront.penumbra = 0.1;
    const lBack = new THREE.PointLight(0xffffff, 0.5);
    lBack.position.set(0, 6, 0);
    s.add(aLight);
    city.add(lFront);
    s.add(lBack);

    // Fast Lines
    const fl = [];
    const dirs = ["z+", "z-", "x+", "x-"];
    const lc = 25, rng = 20;
    function createLines() {
      for (let i = 0; i < lc; i++) {
        setTimeout(() => {
          const g = new THREE.BoxGeometry(0.02, 0.02, Math.random() * 1 + 0.4);
          const m = new THREE.MeshToonMaterial({ color: 0xffff00, side: THREE.DoubleSide });
          const mesh = new THREE.Mesh(g, m);
          mesh.castShadow = true;
          mesh.receiveShadow = true;
          mesh.userData.dir = dirs[Math.floor(Math.random() * dirs.length)];
          switch (mesh.userData.dir) {
            case "z+":
              mesh.position.set(rand(3), Math.abs(rand(2)), -rng + Math.random() * 2 * rng);
              break;
            case "z-":
              mesh.position.set(rand(3), Math.abs(rand(2)), rng - Math.random() * 2 * rng);
              break;
            case "x+":
              mesh.rotation.y = Math.PI * 0.5;
              mesh.position.set(-rng + Math.random() * 2 * rng, Math.abs(rand(2)), rand(3));
              break;
            case "x-":
              mesh.rotation.y = Math.PI * 0.5;
              mesh.position.set(rng - Math.random() * 2 * rng, Math.abs(rand(2)), rand(3));
              break;
          }
          fl.push(mesh);
          city.add(mesh);
        }, Math.random() * 2000);
      }
    }
    createLines();

    // Camera Movement based on scroll
    const sections = ["#resume3d","#intro","#school","#work","#projects","#publications","#leadership","#contact"];
    const vps = [
      {pos: new THREE.Vector3(0,60,0), la: new THREE.Vector3(0,0,0)},
      {pos: new THREE.Vector3(10,15,10), la: new THREE.Vector3(0,0,0)},
      {pos: new THREE.Vector3(-5,10,12), la: new THREE.Vector3(-1,0,2)},
      {pos: new THREE.Vector3(8,8,-2), la: new THREE.Vector3(5,0,-2)},
      {pos: new THREE.Vector3(-8,8,-8), la: new THREE.Vector3(-4,0,-3)},
      {pos: new THREE.Vector3(10,6,-10), la: new THREE.Vector3(6,0,-7)},
      {pos: new THREE.Vector3(15,12,15), la: new THREE.Vector3(0,0,0)},
      {pos: new THREE.Vector3(15,30,15), la: new THREE.Vector3(0,0,0)}
    ];
    let offsets = [];
    function calcOffsets() {
      offsets = sections.map(s => {
        const el = document.querySelector(s);
        return el ? el.offsetTop : 0;
      });
    }
    calcOffsets();
    window.addEventListener('resize', calcOffsets);
    function scrollFrac(){
      return (scrollableContent.scrollTop) / (scrollableContent.scrollHeight - scrollableContent.clientHeight) || 0;
    }
    function camTarget(){
      const n = vps.length,
            fr = scrollFrac() * (n - 1);
      const i = Math.floor(fr),
            lf = fr - i;
      if(i >= n - 1) return vps[n - 1];
      const v1 = vps[i],
            v2 = vps[i + 1];
      return {
        pos: v1.pos.clone().lerp(v2.pos, lf),
        la: v1.la.clone().lerp(v2.la, lf)
      };
    }
    window.addEventListener('resize', () => {
      r.setSize(window.innerWidth, window.innerHeight);
      cam.aspect = window.innerWidth / window.innerHeight;
      cam.updateProjectionMatrix();
      calcOffsets();
    });
    const mousePos = new THREE.Vector2();
    window.addEventListener('mousemove', e => {
      mousePos.x = (e.clientX / window.innerWidth) * 2 - 1;
      mousePos.y = -(e.clientY / window.innerHeight) * 2 + 1;
    }, false);
    const fade = document.getElementById("scroll-fade");
    scrollableContent.addEventListener('scroll', () => {
      const sy = scrollableContent.scrollTop;
      fade.style.opacity = sy > 200 ? "0" : String(1 - sy / 200);
      if(!disableFog){
        fogTgt.near = fogOrig.near;
        fogTgt.far = fogOrig.far;
      }
    });
    let isScroll = false;
    document.getElementById('email').addEventListener('focus', () => {
      fogTgt.near = fogRed.near;
      fogTgt.far = fogRed.far;
      disableFog = true;
    });
    scrollableContent.addEventListener('scroll', () => {
      const sy = scrollableContent.scrollTop;
      const introEl = document.querySelector("#intro");
      const introY = introEl ? introEl.offsetTop : 0;
      if (sy <= introY) {
        disableFog = false;
        const prog = sy / introY;
        fogTgt.near = THREE.MathUtils.lerp(50, fogOrig.near, prog);
        fogTgt.far = THREE.MathUtils.lerp(80, fogOrig.far, prog);
      } else if (!disableFog) {
        const scrollFraction = sy / (scrollableContent.scrollHeight - scrollableContent.clientHeight);
        fogTgt.near = fogOrig.near;
        fogTgt.far = THREE.MathUtils.lerp(fogOrig.far, 35, scrollFraction);
      }
    });
    function animate(){
      requestAnimationFrame(animate);
      if(!isScroll){
        const speed = 0.001;
        city.rotation.y -= ((mousePos.x * 8) - cam.rotation.y) * speed;
        city.rotation.x = 0;
      }
      const sp = 0.2;
      fl.forEach(l => {
        switch(l.userData.dir){
          case 'z+':
            l.position.z += sp;
            if(l.position.z > rng){
              l.position.z = -rng;
              l.position.y = Math.abs(rand(2));
            }
            break;
          case 'z-':
            l.position.z -= sp;
            if(l.position.z < -rng){
              l.position.z = rng;
              l.position.y = Math.abs(rand(2));
            }
            break;
          case 'x+':
            l.position.x += sp;
            if(l.position.x > rng){
              l.position.x = -rng;
              l.position.y = Math.abs(rand(2));
            }
            break;
          case 'x-':
            l.position.x -= sp;
            if(l.position.x < -rng){
              l.position.x = rng;
              l.position.y = Math.abs(rand(2));
            }
            break;
        }
      });
      const ct = camTarget();
      cam.position.lerp(ct.pos, 0.08);
      const dir = new THREE.Vector3().subVectors(ct.la, cam.position).normalize();
      cam.lookAt(cam.position.clone().add(dir));
      const sf = 0.5 + scrollFrac() * 3;
      blds.forEach(b => {
        b.scale.y = b.userData.h * sf;
        b.position.y = (b.userData.h * sf) / 2;
      });
      s.fog.near = THREE.MathUtils.lerp(s.fog.near, fogTgt.near, 0.05);
      s.fog.far = THREE.MathUtils.lerp(s.fog.far, fogTgt.far, 0.05);
      r.render(s, cam);
    }
    animate();
  
    document.getElementById('hamburger').addEventListener('click', () => {
      const navC = document.getElementById('nav-links');
      navC.classList.toggle('active');
      const act = navC.classList.contains('active');
      document.getElementById('hamburger').setAttribute('aria-expanded', act);
    });
  
    document.addEventListener('DOMContentLoaded', () => {
      const introSection = document.querySelector('#intro');
      if(introSection){
        introSection.scrollIntoView();
      }
    });
  
    document.addEventListener("DOMContentLoaded", () => {
      const buttons = document.querySelectorAll(".load-pdf");
      buttons.forEach(button => {
        button.addEventListener("click", () => {
          const pdfUrl = button.getAttribute("data-pdf");
          const pdfContainer = button.nextElementSibling;
          const objectElement = document.createElement("object");
          objectElement.setAttribute("data", pdfUrl);
          objectElement.setAttribute("type", "application/pdf");
          const fallbackLink = document.createElement("a");
          fallbackLink.setAttribute("href", pdfUrl);
          fallbackLink.setAttribute("target", "_blank");
          fallbackLink.textContent = "Download PDF";
          objectElement.appendChild(fallbackLink);
          pdfContainer.style.display = "block";
          pdfContainer.innerHTML = "";
          pdfContainer.appendChild(objectElement);
          button.style.display = "none";
        });
      });
    });
  </script>
</body>
</html>
